---
date: 2025-06-18
day: Wednesday
tags: [daily, daily-digest, dev, work, research, ai_tools, social, news, oauth, react, authentication, api-design, debugging]
generated: 2025-06-18 18:32
categories: [dev, work, research, ai_tools, social, news]
themes: [OAuth 2.0 integration, React auth refactor, API design review, Team planning]
prompts: [what_token_storage_strategy_is_safest_for_our_spa_httponly_co, the_billing_team_s_stripe_migration_could_block_our_q3_auth_r]
---

# ðŸ“… Wednesday, June 18, 2025

> **Deep-focus day on OAuth integration and API design, punctuated by sprint planning and a productive debugging session**

Spent the morning driving forward the OAuth 2.0 PKCE implementation for the React app, shifting to API endpoint design reviews after lunch. Debugged a tricky token refresh race condition mid-afternoon that had been causing intermittent 401s in staging. Wrapped up with sprint planning and backlog grooming for Q3.

**Themes:** `OAuth 2.0 integration` Â· `React auth refactor` Â· `API design review` Â· `Team planning`

---

*47 visits Â· 12 searches Â· 24 commands Â· 8 Claude prompts Â· 6 categories*

---

## âœ¨ Notable

- Identified and fixed a race condition in the OAuth token refresh flow that caused intermittent 401 errors on staging
- Completed the PKCE implementation for GitHub and Google providers â€” PR is up for review
- Discovered that the new `/v2/users` endpoint needs rate limiting before launch; opened an issue
- Sprint planning surfaced a dependency on the billing team's Stripe migration â€” flagged early

---

## ðŸ” Searches

- `google` **OAuth 2.0 PKCE flow React SPA best practices** â€” 09:15
- `google` **react useEffect cleanup async token refresh** â€” 09:42
- `stackoverflow` **express middleware next() called twice error** â€” 10:18
- `google` **passport.js OAuth2Strategy custom callback** â€” 10:45
- `duckduckgo` **RFC 7636 PKCE code verifier requirements** â€” 11:03
- `google` **react-query invalidateQueries vs refetchQueries auth** â€” 13:22
- `google` **openapi 3.1 security scheme oauth2 example** â€” 14:10
- `google` **rate limiting express middleware sliding window** â€” 14:55
- `kagi` **Stripe API migration v2024-06 breaking changes** â€” 15:30
- `google` **vitest mock timer race condition testing** â€” 16:08
- `google` **github actions OIDC token federated credentials** â€” 16:45
- `duckduckgo` **obsidian daily notes template 2025** â€” 17:50

---

## ðŸ¤– Claude / AI Work

- `webapp` Implement OAuth 2.0 PKCE flow for React. Support GitHub and Google as identity providers. Use @tanstack/react-query for token management. â€” 09:30
- `webapp` There's a race condition in the token refresh. Two concurrent requests both detect an expired token and try to refresh simultaneously. How do I implement a mutex/lock pattern in React? â€” 10:30
- `webapp` Review this Express middleware stack for the auth flow. I'm getting "next() called multiple times" in production. Here's the error trace... â€” 11:15
- `api-server` Generate OpenAPI 3.1 spec for the new /v2/users endpoints. Include OAuth2 security scheme, pagination params, and error response schemas. â€” 14:15
- `api-server` Write rate limiting middleware using a sliding window algorithm. Should support per-user and per-IP limits with Redis backing. â€” 15:00
- `webapp` Write comprehensive tests for the token refresh race condition fix. Mock timers and concurrent requests. Use vitest. â€” 16:15
- `infra` Set up GitHub Actions OIDC for deploying to AWS without storing long-lived credentials. Our AWS account ID is [REDACTED]. â€” 16:50
- `docs` Summarize today's OAuth implementation decisions for the team. Cover: why PKCE over implicit flow, token storage strategy (httpOnly cookies vs memory), and the refresh race condition fix. â€” 17:30

---

## ðŸŒ Browser Activity

### âš™ï¸ Dev & Engineering (22)

> Focused on OAuth PKCE implementation, debugging auth middleware, and API design for the v2 endpoints.

**github.com** (8)
  - [feat: Add OAuth PKCE flow for GitHub and Google Â· PR #247](https://github.com/acme-corp/webapp/pull/247) â€” 09:00
  - [fix: Token refresh race condition Â· PR #251](https://github.com/acme-corp/webapp/pull/251) â€” 11:30
  - [Issue #189: Rate limit /v2/users before launch](https://github.com/acme-corp/api-server/issues/189) â€” 15:10
  - [acme-corp/webapp: Actions Â· OIDC deployment](https://github.com/acme-corp/webapp/actions) â€” 16:55
  - [panva/oauth4webapi: OAuth 2.0 for JavaScript](https://github.com/panva/oauth4webapi) â€” 09:20
  - [nextauthjs/next-auth: Authentication for Next.js](https://github.com/nextauthjs/next-auth) â€” 09:25
  - [acme-corp/api-server: /v2/users endpoint spec](https://github.com/acme-corp/api-server/blob/main/docs/api.md) â€” 14:05
  - [Compare Â· main...feature/oauth-pkce](https://github.com/acme-corp/webapp/compare/main...feature/oauth-pkce) â€” 17:15

**stackoverflow.com** (4)
  - [Express middleware next() called multiple times - how to debug?](https://stackoverflow.com/questions/76543210) â€” 10:20
  - [React useEffect cleanup with async operations](https://stackoverflow.com/questions/75432198) â€” 09:45
  - [PKCE code verifier: is S256 mandatory?](https://stackoverflow.com/questions/77123456) â€” 11:05
  - [vitest: how to test race conditions with fake timers?](https://stackoverflow.com/questions/78901234) â€” 16:10

**docs.github.com** (2)
  - [About security hardening with OIDC - GitHub Docs](https://docs.github.com/en/actions/security-for-github-actions/oidc) â€” 16:40
  - [Authorizing OAuth apps - GitHub Docs](https://docs.github.com/en/apps/oauth-apps) â€” 09:10

**npmjs.com** (3)
  - [oauth4webapi - npm](https://www.npmjs.com/package/oauth4webapi) â€” 09:22
  - [@tanstack/react-query - npm](https://www.npmjs.com/package/@tanstack/react-query) â€” 13:20
  - [express-rate-limit - npm](https://www.npmjs.com/package/express-rate-limit) â€” 14:50

**developer.mozilla.org** (2)
  - [Web Crypto API: SubtleCrypto.digest() - MDN](https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/digest) â€” 11:00
  - [HTTP 401 Unauthorized - MDN](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401) â€” 10:25

**vercel.com** (2)
  - [Vercel Deployment: webapp-staging](https://vercel.com/acme-corp/webapp/deployments) â€” 12:00
  - [Vercel Edge Config: Rate Limiting](https://vercel.com/docs/edge-config) â€” 15:05

**datatracker.ietf.org** (1)
  - [RFC 7636 - Proof Key for Code Exchange (PKCE)](https://datatracker.ietf.org/doc/html/rfc7636) â€” 11:10

### ðŸ’¼ Work (10)

> Sprint planning, 1:1 with tech lead, and async Slack discussions about the billing migration timeline.

**linear.app** (3)
  - [ACME-1847: Implement OAuth PKCE flow](https://linear.app/acme-corp/issue/ACME-1847) â€” 08:45
  - [Sprint 23 Board Â· Acme Corp](https://linear.app/acme-corp/team/ENG/active) â€” 15:20
  - [ACME-1903: Rate limiting for v2 API](https://linear.app/acme-corp/issue/ACME-1903) â€” 15:15

**notion.so** (3)
  - [Q3 Engineering Roadmap - Acme Corp](https://notion.so/acme-corp/q3-roadmap) â€” 15:25
  - [OAuth Implementation ADR](https://notion.so/acme-corp/oauth-adr-2025) â€” 17:25
  - [API v2 Design Spec](https://notion.so/acme-corp/api-v2-spec) â€” 14:00

**slack.com** (2)
  - [#eng-backend: Token refresh discussion](https://app.slack.com/client/T0123/C0456) â€” 12:15
  - [#eng-platform: Stripe migration timeline](https://app.slack.com/client/T0123/C0789) â€” 15:35

**meet.google.com** (1)
  - [Sprint Planning - Q3 Week 3](https://meet.google.com/abc-defg-hij) â€” 15:20

**calendar.google.com** (1)
  - [Google Calendar - June 18](https://calendar.google.com) â€” 08:30

### ðŸ”¬ Research (5)

> Read about distributed auth patterns and token storage strategies for SPAs.

**medium.com** (2)
  - [The Complete Guide to OAuth 2.0 and PKCE for SPAs](https://medium.com/@authexpert/oauth-pkce-spa) â€” 09:50
  - [Token Storage in React: Cookies vs Memory vs LocalStorage](https://medium.com/@reactdev/token-storage) â€” 13:30

**arxiv.org** (1)
  - [Formal Analysis of OAuth 2.0 Security (2024)](https://arxiv.org/abs/2403.12345) â€” 13:45

**substack.com** (1)
  - [API Design Weekly: Rate Limiting Done Right](https://apidesign.substack.com/p/rate-limiting) â€” 14:45

**en.wikipedia.org** (1)
  - [Sliding window protocol - Wikipedia](https://en.wikipedia.org/wiki/Sliding_window_protocol) â€” 15:00

### ðŸ¤– AI Tools (5)

> Extended Claude sessions for implementation, debugging, and documentation. Briefly compared Cursor's autocomplete for the auth flow.

**claude.ai** (3)
  - [OAuth PKCE implementation session](https://claude.ai/chat/abc123) â€” 09:30
  - [Token refresh debugging session](https://claude.ai/chat/def456) â€” 10:30
  - [Architecture decision summary](https://claude.ai/chat/ghi789) â€” 17:30

**cursor.sh** (1)
  - [Cursor: webapp/src/auth/ â€” AI autocomplete](https://cursor.sh) â€” 11:45

**copilot.microsoft.com** (1)
  - [GitHub Copilot Chat: Express middleware patterns](https://copilot.microsoft.com) â€” 10:22

### ðŸ’¬ Social (3)

> Checked Hacker News front page, replied to a thread on React auth patterns, and skimmed LinkedIn.

**news.ycombinator.com** (1)
  - [Show HN: Open-source OAuth 2.1 library for Node.js](https://news.ycombinator.com/item?id=40123456) â€” 12:30

**reddit.com** (1)
  - [r/reactjs: Best practices for auth token refresh in 2025](https://reddit.com/r/reactjs/comments/abc123) â€” 12:35

**linkedin.com** (1)
  - [LinkedIn Feed](https://www.linkedin.com/feed/) â€” 12:45

### ðŸ“° News (2)

> Glanced at tech news over lunch.

**techcrunch.com** (1)
  - [GitHub launches native OIDC support for Actions](https://techcrunch.com/2025/06/18/github-oidc) â€” 12:20

**arstechnica.com** (1)
  - [The state of web auth in 2025: passkeys, PKCE, and beyond](https://arstechnica.com/2025/06/web-auth-2025) â€” 12:25

---

## ðŸ’» Shell

```bash
# 08:50  cd ~/code/webapp && git pull origin main
# 08:51  git checkout -b feature/oauth-pkce
# 09:05  npm install oauth4webapi @tanstack/react-query
# 09:06  npm run dev
# 09:35  npx vitest run src/auth/__tests__/ --watch
# 10:40  git stash
# 10:41  git log --oneline -10
# 10:42  git stash pop
# 11:32  git add src/auth/ src/middleware/ && git commit -m "feat: OAuth PKCE flow with GitHub + Google"
# 11:33  git push -u origin feature/oauth-pkce
# 11:35  gh pr create --title "feat: Add OAuth PKCE flow" --body "Implements RFC 7636..."
# 12:00  curl -s https://staging.acme.dev/healthz | jq .
# 14:08  cd ~/code/api-server && git checkout -b feature/v2-users-rate-limit
# 14:30  npm run generate:openapi
# 14:52  npm install express-rate-limit rate-limit-redis
# 15:08  npx vitest run src/middleware/rate-limit.test.ts
# 16:12  cd ~/code/webapp && npx vitest run src/auth/refresh.test.ts
# 16:13  npx vitest run --coverage
# 16:48  gh workflow run deploy-staging.yml --ref feature/oauth-pkce
# 16:50  aws sts get-caller-identity | jq .Account
# 17:00  git add . && git commit -m "test: Add race condition tests for token refresh"
# 17:01  git push
# 17:10  npm run build && npm run lint
# 17:12  gh pr status
# 17:45  cat ~/.zsh_history | wc -l
```

---

## ðŸªž Reflection

### What token storage strategy is safest for our SPA â€” httpOnly cookies, in-memory, or a service worker approach?
answer_what_token_storage_strategy_is_safest_for_our_spa_httponly_co::

### The billing team's Stripe migration could block our Q3 auth release â€” what's the contingency plan?
answer_the_billing_team_s_stripe_migration_could_block_our_q3_auth_r::

---

## ðŸ“ Notes

> _Add your reflections here_

---

*Generated by [Daily Digest](https://github.com/brianruggieri/obsidian-daily-digest). AI summary by Anthropic API.*
